(()=>{"use strict";class e{constructor(e,t,s,i){this.x=e,this.y=t,this.id=s,console.log(`Enemy speed multiplier:${i}`),this.speed=Math.random()/250*i,this.speedMultiplier=i,this.speed<.001*i&&(this.speed=.001*i);const h=Math.floor(6*Math.random())+6;this.height=h,this.width=.48802*h,this.brightness=!0}getCoordinates(){return[this.x,this.y]}getHeight(){return this.height}getWidth(){return this.width}getSpeed(){return this.speed}getShape(){return this.shape}getId(){return this.id}appendToHtml(e){this.html=document.createElement("div");const t=this.getCoordinates();this.html.className=this.getShape(),this.html.id=this.getId().toString(),this.html.style.left=`${t[0].toString()}vw`,this.html.style.top=`${t[1].toString()}vh`,this.html.style.width=`${this.width}vw`,this.html.style.height=`${this.height}vh`,this.html.style.zIndex=this.getId().toString(),e.appendChild(this.html)}swapBrightness(){if(!0===this.brightness)return this.brightness=!1,this.html.style.filter="brightness(70%)",void(this.html.style.opacity="50%");this.brightness=!0,this.html.style.filter="brightness(100%)",this.html.style.opacity="100%"}checkCollision(e){const t=e.getCoordinates();return!(t[0]+e.getWidth()<this.x||t[0]>this.x+this.width||t[1]+e.getHeight()<this.y||t[1]>this.y+this.height)}}var t,s;!function(e){e.Chaser="Chaser",e.Random="Random",e.Escape="Escape"}(t||(t={})),function(e){e.Circle="circle",e.Square="square",e.Triangle="triangle"}(s||(s={}));const i=class extends e{constructor(e,i,h,n){super(e,i,h,n),this.type=t.Chaser,this.shape=s.Triangle}revert(){this.x=this.oldX,this.y=this.oldY}stopSpinning(e){this.html.style.animation="",e.appendChild(this.html)}move(e,t){this.oldX=this.x,this.oldY=this.y,this.x+=this.speed*(Math.abs(this.x-e)/3+1)*(this.x>e?-1:1),this.y+=this.speed*(Math.abs(this.y-t)/3+1)*(this.y>t?-1:1),this.x>100-this.width?this.x=100-this.width:this.x<0&&(this.x=0),this.y>100-this.height?this.y=100-this.height:this.y<0&&(this.y=0)}onHitTarget(){return"Over"}},h=class extends e{constructor(e,i,h,n){super(e,i,h,n),this.type=t.Escape,this.shape=s.Circle,this.speed*=.5,this.canGiveScore=!0,this.canMove=!0,this.evade=!0}move(e,t){this.canMove&&(this.x+=this.speed*(100-Math.abs(this.x-e)/2+1)*(this.x>e?1:-1),this.y+=this.speed*(100-Math.abs(this.y-t)/2+1)*(this.y>t?1:-1),this.x>100-this.width?this.x=100-this.width:this.x<0&&(this.x=0),this.y>100-this.height?this.y=100-this.height:this.y<0&&(this.y=0))}forceMove(){this.x+=this.pushX,this.y+=this.pushY,this.x>100-this.width?this.x=100-this.width:this.x<0&&(this.x=0),this.y>100-this.height?this.y=100-this.height:this.y<0&&(this.y=0)}push(e){if(100===e)return this.canMove=!0,this.canGiveScore=!0,this.html.style.opacity="100%",void(this.evade=!0);setTimeout((()=>{this.forceMove(),this.push(e+1)}),5)}onHitTarget(){return this.canGiveScore?(this.canGiveScore=!1,this.canMove=!1,this.html.style.opacity="30%",this.pushX=Math.random()/6*(Math.random()>.5?1:-1)*this.speedMultiplier,this.pushY=Math.random()/6*(Math.random()>.5?1:-1)*this.speedMultiplier,this.push(0),"Score"):(this.evade&&(this.evade=!1,setTimeout((()=>{this.evade=!0}),50),this.pushX*=1.5,this.pushY*=1.5),"")}},n=class extends e{constructor(e,i,h,n){super(e,i,h,n),this.type=t.Random,this.shape=s.Square,this.xPath=Math.random()*(Math.random()>.5?1:-1)*50,this.yPath=Math.random()*(Math.random()>.5?1:-1)*50}changePath(){for(this.xPath=Math.random()*(Math.random()>.5?1:-1)*80,this.yPath=Math.random()*(Math.random()>.5?1:-1)*80;Math.abs(this.xPath)+Math.abs(this.yPath)<40;)this.xPath=Math.random()*(Math.random()>.5?1:-1)*80,this.yPath=Math.random()*(Math.random()>.5?1:-1)*80}move(){this.x>100-this.width?(this.x=100-this.width,this.changePath()):this.x<0&&(this.changePath(),this.x=0,this.changePath()),this.y>100-this.height?(this.y=100-this.height,this.changePath()):this.y<0&&(this.y=0,this.changePath()),this.x+=this.xPath*this.speed,this.y+=this.yPath*this.speed}onHitTarget(){return"Over"}};class a{constructor(e,t,s,i){this.x=e,this.y=t,this.speed=s,this.cursor=i}getCoordinates(){return[this.x,this.y]}getSpeed(){return this.speed}move(e,t){if(this.cursor)return this.x=e-1.5,void(this.y=t-3);this.x+=(e-this.x)*this.speed/10+(e-this.x>0?1:-1)*this.speed,this.y+=(t-this.y)*this.speed/10+(t-this.y>0?1:-1)*this.speed,this.x>97?this.x=97:this.x<0&&(this.x=0),this.y>94?this.y=94:this.y<0&&(this.y=0)}checkCollision(e){const t=e.getCoordinates();if("triangle"!==e.getShape()){if(t[0]+e.getWidth()<this.x)return!1;if(t[0]>this.x+3)return!1;if(t[1]+e.getHeight()<this.y)return!1;if(t[1]>this.y+6)return!1}else{if(t[0]+.9*e.getWidth()<this.x)return!1;if(t[0]>this.x+2.92812*.9)return!1;if(t[1]+e.getHeight()<this.y)return!1;if(t[1]>this.y+4.5)return!1}return!0}}let r=document.getElementById("chaserValue"),o=document.getElementById("randomValue"),d=document.getElementById("escapeValue"),l=document.getElementById("randomEnemyValue"),c=document.getElementById("enemySpeedValue"),m=document.getElementById("playerSpeedValue");const p=document.getElementById("chaserRange"),y=document.getElementById("randomRange"),u=document.getElementById("escapeRange"),g=document.getElementById("randomEnemyRange"),v=document.getElementById("enemySpeedRange"),M=document.getElementById("playerSpeedRange");p.oninput=()=>{r.innerHTML=`Chasers: ${p.value}`},y.oninput=()=>{o.innerHTML=`Randoms: ${y.value}`},u.oninput=()=>{d.innerHTML=`Escapes: ${u.value}`},g.oninput=()=>{l.innerHTML=`Random enemies: ${g.value}`},v.oninput=()=>{c.innerHTML=`Enemy speed: ${v.value}%`},M.oninput=()=>{m.innerHTML=`Player speed: ${M.value}%`};const f=document.getElementById("follow"),E=document.getElementById("cursor");f.addEventListener("click",(()=>{!0===E.checked?(E.checked=!1,document.getElementById("playerSpeedSlider").style.display="initial"):f.checked=!0})),E.addEventListener("click",(()=>{!0===f.checked?(f.checked=!1,document.getElementById("playerSpeedSlider").style.display="none"):E.checked=!0}));const I=new class{setMouseCoordinates(e){this.mouseX=e.pageX/this.windowWidth*100,this.mouseY=e.pageY/this.windowHeight*100}constructor(){this.body=document.getElementById("canvas"),this.enemies=new Array,this.chasers=new Array,this.windowHeight=window.innerHeight,this.windowWidth=window.innerWidth,document.addEventListener("mousemove",this.setMouseCoordinates.bind(this))}cleanup(e){this.endMenu.remove(),this.playerDiv.remove(),this.scoreDiv.remove();for(const e of this.enemies)document.getElementById(e.getId().toString()).remove();for(;this.enemies.length>0;)this.enemies.pop();for(;this.chasers.length>0;)this.chasers.pop();this.body.style.filter="brightness(100%)",!0!==e?document.getElementById("difficultyPage").style.display="initial":this.startGame(this.startSetting[0],this.startSetting[1],this.startSetting[2],this.startSetting[3],this.startSetting[4],this.startSetting[5],1===this.startSetting[6])}endGame(){clearInterval(this.actionInterval),clearInterval(this.scoreInterval),this.endMenu=document.createElement("div"),this.endMenu.className="endMenu";const e=document.createElement("h1");e.innerHTML=`Ended game with score ${this.score}\n             Restart?`,this.endMenu.appendChild(e);const t=document.createElement("button");t.innerHTML="RESTART",t.addEventListener("click",this.cleanup.bind(this,!0)),this.endMenu.appendChild(t);const s=document.createElement("button");s.innerHTML="MENU",s.className="endMenuButton",s.addEventListener("click",this.cleanup.bind(this,!1)),this.endMenu.appendChild(s),this.score=0;for(const e of this.enemies)e.swapBrightness();this.body.style.filter="brightness(60%)",this.playerDiv.style.filter="brightness(70%)",this.playerDiv.style.opacity="50%";for(const e of this.chasers)e.stopSpinning(this.body);this.body.appendChild(this.endMenu)}shuffleArray(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}}redraw(){const e=this.player.getCoordinates();document.getElementById("0").style.left=`${e[0]}vw`,document.getElementById("0").style.top=`${e[1]}vh`;for(const e of this.enemies)document.getElementById(e.getId().toString()).style.left=`${e.getCoordinates()[0]}vw`,document.getElementById(e.getId().toString()).style.top=`${e.getCoordinates()[1]}vh`;this.scoreDiv.innerHTML=`${this.score}`}actionQueue(){const e=this.player.getCoordinates();void 0!==this.mouseX&&void 0!==this.mouseY&&this.player.move(this.mouseX,this.mouseY);for(const t of this.enemies){if(this.player.checkCollision(t)){const e=t.onHitTarget();if("Over"===e)return this.redraw(),this.endGame(),void console.log(`Killed by enemy:${t.getId()}`);"Score"===e&&(this.score+=5)}"square"===t.getShape()?t.move():"circle"===t.getShape()&&t.move(e[0],e[1])}let t=[];for(let e=0;e<this.chasers.length;e++){t[e]=[];for(let s=0;s<this.chasers.length;s++)t[e][s]=!1}this.shuffleArray(this.chasers);for(let s=0;s<this.chasers.length;s++){this.chasers[s].move(e[0],e[1]);let i=!0;for(let e=0;e<this.chasers.length;e++)if(this.chasers[s].getId()!==this.chasers[e].getId()&&!0!==t[s][e]&&this.chasers[s].checkCollision(this.chasers[e])){i=!1,t[e][s]=!0;break}i||this.chasers[s].revert()}this.redraw()}startGame(e,s,r,o,d,l,c){document.getElementById("difficultyPage").style.display="none",this.startSetting=[e,s,r,o,d,l,!0===c?1:0],this.score=0,this.scoreDiv=document.createElement("h1"),this.scoreDiv.className="score",this.scoreDiv.innerHTML=`${this.score}`,this.scoreDiv.style.zIndex="-1",this.body.appendChild(this.scoreDiv),this.player=new a(50,50,l/100*.06,c),this.playerDiv=document.createElement("div"),this.playerDiv.id="0",this.playerDiv.className="player",this.playerDiv.style.left="50vw",this.playerDiv.style.top="50vh",this.playerDiv.style.zIndex="2000000",this.body.appendChild(this.playerDiv),this.actionInterval=setInterval(this.actionQueue.bind(this),5),this.scoreInterval=setInterval((()=>{this.score++}),1e3);const m=new class{constructor(e){this.enemiesCreated=0,this.speedMultiplier=e/100}getRandomEnemy(){const e=Math.floor(3*Math.random());let t=88*Math.random(),s=88*Math.random();for(;t>35&&t<65&&s>35&&s<65;)t=88*Math.random(),s=88*Math.random();return 1===e?(this.enemiesCreated++,new i(t,s,this.enemiesCreated,this.speedMultiplier)):2===e?(this.enemiesCreated++,new h(t,s,this.enemiesCreated,this.speedMultiplier)):(this.enemiesCreated++,new n(t,s,this.enemiesCreated,this.speedMultiplier))}getSpecificEnemy(e){let s=88*Math.random(),a=88*Math.random();for(;s>35&&s<65&&a>35&&a<65;)s=88*Math.random(),a=88*Math.random();return this.enemiesCreated++,e===t.Chaser?new i(s,a,this.enemiesCreated,this.speedMultiplier):e===t.Escape?new h(s,a,this.enemiesCreated,this.speedMultiplier):e===t.Random?new n(s,a,this.enemiesCreated,this.speedMultiplier):void 0}getEnemiesCreated(){return this.enemiesCreated}}(d);for(let s=0;s<e;s++){let e=m.getSpecificEnemy(t.Chaser);e.appendToHtml(this.body),this.enemies.push(e),this.chasers.push(e)}for(let e=0;e<r;e++){let e=m.getSpecificEnemy(t.Escape);e.appendToHtml(this.body),this.enemies.push(e)}for(let e=0;e<s;e++){let e=m.getSpecificEnemy(t.Random);e.appendToHtml(this.body),this.enemies.push(e)}for(let e=0;e<o;e++){let e=m.getRandomEnemy();e.appendToHtml(this.body),this.enemies.push(e),"triangle"===e.getShape()&&this.chasers.push(e)}}};document.getElementById("startButton").addEventListener("click",(()=>{const e=parseInt(document.getElementById("chaserRange").value),t=parseInt(document.getElementById("randomRange").value),s=parseInt(document.getElementById("escapeRange").value),i=parseInt(document.getElementById("randomEnemyRange").value),h=parseInt(document.getElementById("enemySpeedRange").value),n=parseInt(document.getElementById("playerSpeedRange").value);I.startGame(e,t,s,i,h,n,E.checked)}))})();